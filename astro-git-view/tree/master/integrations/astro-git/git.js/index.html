<!doctype html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Astro Git">
    <title>Astro Git</title>
    <script type="module">
const storedDarkness = localStorage.getItem("darkmode");
if(storedDarkness != null && storedDarkness != document.body.hasAttribute("data-dark").toString()){
  document.body.toggleAttribute("data-dark");
}
</script>
    
  <link rel="stylesheet" href="/astro-git-view/assets/asset.75d06a62.css"><script type="module" src="/astro-git-view/entry.69c8a0c74.js" astro-script="/astro-git-view/tree/master/integrations/astro-git/git.js//script-0"></script>
</head>
  <body data-dark="" data-lunr-dir="lunr">
    <button id="darkmode-button" type="button" style="float:right; display: none;">light</button><script type="module">
const darkmodeButton = document.getElementById("darkmode-button");
function toggleDarkmode(){
	let isDarkNow = document.body.toggleAttribute("data-dark");
	localStorage.setItem("darkmode", isDarkNow);
	darkmodeButton.innerText = isDarkNow ? "light" : "dark";
}
const storedDarkness = localStorage.getItem("darkmode");
if(storedDarkness != null && storedDarkness != document.body.hasAttribute("data-dark")){
	darkmodeButton.innerText = storedDarkness == "true" ? "light" : "dark";
}
darkmodeButton.addEventListener("click", toggleDarkmode);
darkmodeButton.style.display = "block"
</script> 
    <header class="repo-header">
  <a href="/astro-git-view">All repositories</a>
  <h1><a href="/astro-git-view/astro-git-view/">astro-git-view</a></h1>
  <div>
      <a href="/astro-git-view/astro-git-view/tree/master/LICENSE">License</a>
  </div>
  <p>A server-side generated source code explorer for git-repositories
</p>
  <nav class="repo-nav">
    <div>
      <script type="module">
window.refSelectorOnChange = (select) => {
	let value = select.value
  if(value && value != select.dataset.current){
    if(window.location.pathname.includes(select.dataset.current)){
      window.location = window.location.pathname.replace(select.dataset.current, value);
    } else {
      window.location = `/${select.dataset.repo}/tree/${value}`;
    }
  } 
} 
</script>
<select data-repo="astro-git-view" data-current="master" onchange="window.refSelectorOnChange(this)">
  <optgroup label="branches">
    <option value="master" selected>
          master
        </option>
  </optgroup>
  
  
</select>
      <span class="branches"><b>1</b> branch</span>
      
    </div>
    <div>
      <div style="display:inline-block">
        <noscript>
  Search requires javascript
</noscript>
<form id="search-form" data-index="astro-git-view">
  <input type="text" name="query" placeholder="keyword +require -exclude" title="Keyword search for the files in this repo">
  <button>
 	Search
  </button>
</form>

      </div>
    </div>
  </nav>
</header>
<section id="search-result-section" class="headered-section" style="display:none;">
  <header class="headered-section-header">
    Search result for <span id="search-result-query"></span>.
    <span id="search-result-total"></span> hits.
    
    <button id="search-result-close">
      close search
    </button>
  </header>
  <ul id="search-result-list">
  </ul>
</section>
<template id="search-item-template">
  <li class="search-item headered-section">
    <h4 class="search-header headered-section-header">
      <span class="base-path">/</span>
      <a class="url"></a>
    </h4>
    <div class="search-hit">
      <table class="content-hit" style="white-space: pre">
        <tbody class="content-hit-lines"></tbody>
      </table>
      <p class="field-hits"></p>
      <!-- <pre class="debug"/> -->
    </div>
  </li>
</template>
<template id="search-item-content-line-template">
  <tr class="line"><td class="line-number"><a></a></td><td class="line-content"></td></tr>
</template><article class="file-browser">
    <details class="history-bar headered-section">
  <summary class="latest-commit headered-section-header">
    <span><relative-datetime title="2022-05-01 20:12">2022-05-01 20:12</relative-datetime>
</span>
    <b class="commit-message">
      SSR- and SSG+SSR-modes; file- and line-diffs; docker for local testing SSG+SSR

    </b>
    <div>
      <span class="commit-author-name">
        Siver K. Volle
      </span>
      <span>
        <a href="/astro-git-view/astro-git-view/commit/9b5fdf144a5955edf7fdadea5fdb45ad2de04ea0">
          9b5fdf1
        </a>
      </span>
    </div>
  </summary>
  <table class="history-table">
    <tbody>
      <tr>
          <td class="commit-datetime">
            <relative-datetime title="2022-05-01 20:12">2022-05-01 20:12</relative-datetime>

          </td>
          <td class="commit-message">
            <a href="/astro-git-view/astro-git-view/commit/9b5fdf144a5955edf7fdadea5fdb45ad2de04ea0">SSR- and SSG+SSR-modes; file- and line-diffs; docker for local testing SSG+SSR
</a>
            <span class="commit-tags">
              
              
            </span>
          </td>
          <td class="commit-author-name">
              Siver K. Volle
          </td>
          <td class="commit-shorthash" style="font-family: monospace">
            <a href="/astro-git-view/astro-git-view/commit/9b5fdf144a5955edf7fdadea5fdb45ad2de04ea0" title="show diff">9b5fdf1</a>
          </td>
        </tr><tr>
          <td class="commit-datetime">
            <relative-datetime title="2022-04-18 18:39">2022-04-18 18:39</relative-datetime>

          </td>
          <td class="commit-message">
            <a href="/astro-git-view/astro-git-view/commit/9a34364b99357a698500cbdf6e8ca330cda6de3f">better lunr in dev-mode; better file diffs
</a>
            <span class="commit-tags">
              
              
            </span>
          </td>
          <td class="commit-author-name">
              Siver K. Volle
          </td>
          <td class="commit-shorthash" style="font-family: monospace">
            <a href="/astro-git-view/astro-git-view/commit/9a34364b99357a698500cbdf6e8ca330cda6de3f" title="show diff">9a34364</a>
          </td>
        </tr><tr>
          <td class="commit-datetime">
            <relative-datetime title="2022-04-17 19:29">2022-04-17 19:29</relative-datetime>

          </td>
          <td class="commit-message">
            <a href="/astro-git-view/astro-git-view/commit/f3e5297d70eb797e9f4c0352b48240d4a9ade329">support for github pages; max-lines in file view
</a>
            <span class="commit-tags">
              
              
            </span>
          </td>
          <td class="commit-author-name">
              Siver K. Volle
          </td>
          <td class="commit-shorthash" style="font-family: monospace">
            <a href="/astro-git-view/astro-git-view/commit/f3e5297d70eb797e9f4c0352b48240d4a9ade329" title="show diff">f3e5297</a>
          </td>
        </tr><tr>
          <td class="commit-datetime">
            <relative-datetime title="2022-04-16 13:57">2022-04-16 13:57</relative-datetime>

          </td>
          <td class="commit-message">
            <a href="/astro-git-view/astro-git-view/commit/304458ce220b8d1b153ea4ccde168450b5cc6257">commit-page with line diffs
</a>
            <span class="commit-tags">
              
              
            </span>
          </td>
          <td class="commit-author-name">
              Siver K. Volle
          </td>
          <td class="commit-shorthash" style="font-family: monospace">
            <a href="/astro-git-view/astro-git-view/commit/304458ce220b8d1b153ea4ccde168450b5cc6257" title="show diff">304458c</a>
          </td>
        </tr><tr>
          <td class="commit-datetime">
            <relative-datetime title="2022-04-16 00:25">2022-04-16 00:25</relative-datetime>

          </td>
          <td class="commit-message">
            <a href="/astro-git-view/astro-git-view/commit/8024c0a7362e096cfdfe374bd38c71b830e41b57">Included readme and licenses; made the plugins into npm-modules; removed more dead-links and ui/ux-bugs
</a>
            <span class="commit-tags">
              
              
            </span>
          </td>
          <td class="commit-author-name">
              Siver K. Volle
          </td>
          <td class="commit-shorthash" style="font-family: monospace">
            <a href="/astro-git-view/astro-git-view/commit/8024c0a7362e096cfdfe374bd38c71b830e41b57" title="show diff">8024c0a</a>
          </td>
        </tr><tr>
          <td class="commit-datetime">
            <relative-datetime title="2022-04-15 17:21">2022-04-15 17:21</relative-datetime>

          </td>
          <td class="commit-message">
            <a href="/astro-git-view/astro-git-view/commit/37a934a46dc2913c0ad2448ab7ddbf006956f248">Multi-repo support; refactored astro-git and astro-lunr into independent plugins
</a>
            <span class="commit-tags">
              
              
            </span>
          </td>
          <td class="commit-author-name">
              Siver K. Volle
          </td>
          <td class="commit-shorthash" style="font-family: monospace">
            <a href="/astro-git-view/astro-git-view/commit/37a934a46dc2913c0ad2448ab7ddbf006956f248" title="show diff">37a934a</a>
          </td>
        </tr>
    </tbody>
  </table>
</details>
    <section class="file-content-section headered-section">
  <header class="headered-section-header">
    <div style="display: inline-block">
      <a href="/astro-git-view/astro-git-view/tree/master">astro-git-view</a>
 / <a href="/astro-git-view/astro-git-view/tree/master/integrations">integrations</a> / <a href="/astro-git-view/astro-git-view/tree/master/integrations/astro-git">astro-git</a> / <b>git.js</b>

      <div>
        <span>309 lines</span>
        <span>(280 sloc)</span>
        | 
        <span class="bytes">
  9.4 KB
</span>
      </div>
    </div>
    
  </header>
  <div>
    <table class="file-content">
      <tbody>
        <tr class="line">
            <td class="line-number">
              <a href="#L1" id="L1">
                1
              </a>
            </td>
            <td class="line-content">import fs from 'fs';</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L2" id="L2">
                2
              </a>
            </td>
            <td class="line-content">import path from 'path';</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L3" id="L3">
                3
              </a>
            </td>
            <td class="line-content">import git from 'isomorphic-git'</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L4" id="L4">
                4
              </a>
            </td>
            <td class="line-content">import { TREE } from 'isomorphic-git'</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L5" id="L5">
                5
              </a>
            </td>
            <td class="line-content">import * as Diff from 'diff';</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L6" id="L6">
                6
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L7" id="L7">
                7
              </a>
            </td>
            <td class="line-content">export class Repo {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L8" id="L8">
                8
              </a>
            </td>
            <td class="line-content">  static DEFAULT_BAD_PATH_FILTER = (path) => path.match(/(?:^|\/)index.html(?:$|\/)/);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L9" id="L9">
                9
              </a>
            </td>
            <td class="line-content">  constructor({dir, includeCommitRefs, name, branchFilter, tagFilter, badPathFilter, ignoreDiffFilter, maxFileSizeForDiff, verbose}){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L10" id="L10">
                10
              </a>
            </td>
            <td class="line-content">    this.config = {fs, dir};</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L11" id="L11">
                11
              </a>
            </td>
            <td class="line-content">    this.isBadPath = badPathFilter || DEFAULT_BAD_PATH_FILTER;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L12" id="L12">
                12
              </a>
            </td>
            <td class="line-content">    this.includeCommitRefs = includeCommitRefs == true;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L13" id="L13">
                13
              </a>
            </td>
            <td class="line-content">    this.ignoreDiffFilter = ignoreDiffFilter;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L14" id="L14">
                14
              </a>
            </td>
            <td class="line-content">    this.maxFileSizeForDiff = maxFileSizeForDiff;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L15" id="L15">
                15
              </a>
            </td>
            <td class="line-content">    this.name = name || dir.split("/").pop();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L16" id="L16">
                16
              </a>
            </td>
            <td class="line-content">    this.branchFilter = branchFilter || (() => true);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L17" id="L17">
                17
              </a>
            </td>
            <td class="line-content">    this.tagFilter = tagFilter || (() => true);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L18" id="L18">
                18
              </a>
            </td>
            <td class="line-content">    this.verbose = verbose;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L19" id="L19">
                19
              </a>
            </td>
            <td class="line-content">    this.logMap = new Map();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L20" id="L20">
                20
              </a>
            </td>
            <td class="line-content">    this.oidMap = new Map();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L21" id="L21">
                21
              </a>
            </td>
            <td class="line-content">    this.refMap = new Map();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L22" id="L22">
                22
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L23" id="L23">
                23
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L24" id="L24">
                24
              </a>
            </td>
            <td class="line-content">  getName(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L25" id="L25">
                25
              </a>
            </td>
            <td class="line-content">    return this.name;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L26" id="L26">
                26
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L27" id="L27">
                27
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L28" id="L28">
                28
              </a>
            </td>
            <td class="line-content">  getDescription(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L29" id="L29">
                29
              </a>
            </td>
            <td class="line-content">    return this.description</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L30" id="L30">
                30
              </a>
            </td>
            <td class="line-content">      || (this.description = fs.readFileSync(path.join(this.config.dir, "/.git/description")));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L31" id="L31">
                31
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L32" id="L32">
                32
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L33" id="L33">
                33
              </a>
            </td>
            <td class="line-content">  async sortRefs(refs){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L34" id="L34">
                34
              </a>
            </td>
            <td class="line-content">    return (await Promise.all(refs.map(async ref => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L35" id="L35">
                35
              </a>
            </td>
            <td class="line-content">      let oid = await this.resolveRef(ref);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L36" id="L36">
                36
              </a>
            </td>
            <td class="line-content">      let object = await this.getObject(oid);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L37" id="L37">
                37
              </a>
            </td>
            <td class="line-content">      return {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L38" id="L38">
                38
              </a>
            </td>
            <td class="line-content">        ref, oid, object,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L39" id="L39">
                39
              </a>
            </td>
            <td class="line-content">        date: this.getDateOfCommit(object)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L40" id="L40">
                40
              </a>
            </td>
            <td class="line-content">      };</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L41" id="L41">
                41
              </a>
            </td>
            <td class="line-content">    }))).sort((a,b) => b.date - a.date).map(a => a.ref);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L42" id="L42">
                42
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L43" id="L43">
                43
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L44" id="L44">
                44
              </a>
            </td>
            <td class="line-content">  async getMainBranch(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L45" id="L45">
                45
              </a>
            </td>
            <td class="line-content">    return this.mainBranch</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L46" id="L46">
                46
              </a>
            </td>
            <td class="line-content">      || (this.mainBranch = await git.currentBranch(this.config));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L47" id="L47">
                47
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L48" id="L48">
                48
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L49" id="L49">
                49
              </a>
            </td>
            <td class="line-content">  async latestCommit(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L50" id="L50">
                50
              </a>
            </td>
            <td class="line-content">    let main = await this.getMainBranch();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L51" id="L51">
                51
              </a>
            </td>
            <td class="line-content">    let log = await this.getLog(main);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L52" id="L52">
                52
              </a>
            </td>
            <td class="line-content">    return log[0];</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L53" id="L53">
                53
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L54" id="L54">
                54
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L55" id="L55">
                55
              </a>
            </td>
            <td class="line-content">  async getBranches(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L56" id="L56">
                56
              </a>
            </td>
            <td class="line-content">    return this.branches</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L57" id="L57">
                57
              </a>
            </td>
            <td class="line-content">      || (this.branches = await this.sortRefs((await git.listBranches(this.config)).filter(this.branchFilter)));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L58" id="L58">
                58
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L59" id="L59">
                59
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L60" id="L60">
                60
              </a>
            </td>
            <td class="line-content">  async getTags(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L61" id="L61">
                61
              </a>
            </td>
            <td class="line-content">    return this.tags</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L62" id="L62">
                62
              </a>
            </td>
            <td class="line-content">      || (this.tags = await this.sortRefs((await git.listTags(this.config)).filter(this.tagFilter)));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L63" id="L63">
                63
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L64" id="L64">
                64
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L65" id="L65">
                65
              </a>
            </td>
            <td class="line-content">  async getNamedRefs(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L66" id="L66">
                66
              </a>
            </td>
            <td class="line-content">    return (await this.getBranches()).concat(await this.getTags());</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L67" id="L67">
                67
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L68" id="L68">
                68
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L69" id="L69">
                69
              </a>
            </td>
            <td class="line-content">  async getCommitRefs(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L70" id="L70">
                70
              </a>
            </td>
            <td class="line-content">    return this.commitRefs</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L71" id="L71">
                71
              </a>
            </td>
            <td class="line-content">      || (this.commitRefs =</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L72" id="L72">
                72
              </a>
            </td>
            <td class="line-content">          Array.from(new Set((await Promise.all((await this.getNamedRefs())</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L73" id="L73">
                73
              </a>
            </td>
            <td class="line-content">            .map(async ref => await this.getLog(ref))))</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L74" id="L74">
                74
              </a>
            </td>
            <td class="line-content">            .flatMap(log => log.map(({oid}) => oid)))));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L75" id="L75">
                75
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L76" id="L76">
                76
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L77" id="L77">
                77
              </a>
            </td>
            <td class="line-content">  async getLog(ref){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L78" id="L78">
                78
              </a>
            </td>
            <td class="line-content">    if(!this.logMap.has(ref)){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L79" id="L79">
                79
              </a>
            </td>
            <td class="line-content">      let log = await git.log({...this.config, ref});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L80" id="L80">
                80
              </a>
            </td>
            <td class="line-content">      this.logMap.set(ref, log);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L81" id="L81">
                81
              </a>
            </td>
            <td class="line-content">      return log;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L82" id="L82">
                82
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L83" id="L83">
                83
              </a>
            </td>
            <td class="line-content">    return this.logMap.get(ref);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L84" id="L84">
                84
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L85" id="L85">
                85
              </a>
            </td>
            <td class="line-content">  </td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L86" id="L86">
                86
              </a>
            </td>
            <td class="line-content">  async resolveRef(ref){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L87" id="L87">
                87
              </a>
            </td>
            <td class="line-content">    if(!this.refMap.has(ref)){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L88" id="L88">
                88
              </a>
            </td>
            <td class="line-content">      let oid = await git.resolveRef({...this.config, ref});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L89" id="L89">
                89
              </a>
            </td>
            <td class="line-content">      this.refMap.set(ref, oid);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L90" id="L90">
                90
              </a>
            </td>
            <td class="line-content">      return oid;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L91" id="L91">
                91
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L92" id="L92">
                92
              </a>
            </td>
            <td class="line-content">    return this.refMap.get(ref);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L93" id="L93">
                93
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L94" id="L94">
                94
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L95" id="L95">
                95
              </a>
            </td>
            <td class="line-content">  async getTree(oid){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L96" id="L96">
                96
              </a>
            </td>
            <td class="line-content">    return await git.readTree({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L97" id="L97">
                97
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L98" id="L98">
                98
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L99" id="L99">
                99
              </a>
            </td>
            <td class="line-content">  async getBlob(oid){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L100" id="L100">
                100
              </a>
            </td>
            <td class="line-content">    return await git.readBlob({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L101" id="L101">
                101
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L102" id="L102">
                102
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L103" id="L103">
                103
              </a>
            </td>
            <td class="line-content">  async getObject(oid){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L104" id="L104">
                104
              </a>
            </td>
            <td class="line-content">    return await git.readObject({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L105" id="L105">
                105
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L106" id="L106">
                106
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L107" id="L107">
                107
              </a>
            </td>
            <td class="line-content">  async getCommit(oid){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L108" id="L108">
                108
              </a>
            </td>
            <td class="line-content">    return await git.readCommit({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L109" id="L109">
                109
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L110" id="L110">
                110
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L111" id="L111">
                111
              </a>
            </td>
            <td class="line-content">  async getTag(oid){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L112" id="L112">
                112
              </a>
            </td>
            <td class="line-content">    return await git.readTag({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L113" id="L113">
                113
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L114" id="L114">
                114
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L115" id="L115">
                115
              </a>
            </td>
            <td class="line-content">  async resolveObject(oid){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L116" id="L116">
                116
              </a>
            </td>
            <td class="line-content">    if(!this.oidMap.has(oid)){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L117" id="L117">
                117
              </a>
            </td>
            <td class="line-content">      let object = await git.readObject({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L118" id="L118">
                118
              </a>
            </td>
            <td class="line-content">      if(object.type === "tree"){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L119" id="L119">
                119
              </a>
            </td>
            <td class="line-content">        object = await git.readTree({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L120" id="L120">
                120
              </a>
            </td>
            <td class="line-content">      } else if(object.type === "blob") {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L121" id="L121">
                121
              </a>
            </td>
            <td class="line-content">        object = await git.readBlob({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L122" id="L122">
                122
              </a>
            </td>
            <td class="line-content">      } else if(object.type === "commit") {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L123" id="L123">
                123
              </a>
            </td>
            <td class="line-content">        object = await git.readCommit({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L124" id="L124">
                124
              </a>
            </td>
            <td class="line-content">      } else if(object.type === "tag") {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L125" id="L125">
                125
              </a>
            </td>
            <td class="line-content">        object = await git.readTag({...this.config, oid});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L126" id="L126">
                126
              </a>
            </td>
            <td class="line-content">      } else {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L127" id="L127">
                127
              </a>
            </td>
            <td class="line-content">        throw new Error(`Object retrieved by oid=${oid} has unknown type=${object.type}`);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L128" id="L128">
                128
              </a>
            </td>
            <td class="line-content">      }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L129" id="L129">
                129
              </a>
            </td>
            <td class="line-content">      this.oidMap.set(oid, object);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L130" id="L130">
                130
              </a>
            </td>
            <td class="line-content">      return object;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L131" id="L131">
                131
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L132" id="L132">
                132
              </a>
            </td>
            <td class="line-content">    return this.oidMap.get(oid);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L133" id="L133">
                133
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L134" id="L134">
                134
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L135" id="L135">
                135
              </a>
            </td>
            <td class="line-content">  async walk(trees){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L136" id="L136">
                136
              </a>
            </td>
            <td class="line-content">    return await git.walk({...this.config, trees: trees.map(tree => TREE({ref: tree})), map: async (path, entries) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L137" id="L137">
                137
              </a>
            </td>
            <td class="line-content">      return {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L138" id="L138">
                138
              </a>
            </td>
            <td class="line-content">        path,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L139" id="L139">
                139
              </a>
            </td>
            <td class="line-content">        entries: await Promise.all(entries.map(async (entry, index) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L140" id="L140">
                140
              </a>
            </td>
            <td class="line-content">          if(!entry){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L141" id="L141">
                141
              </a>
            </td>
            <td class="line-content">            return null;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L142" id="L142">
                142
              </a>
            </td>
            <td class="line-content">          }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L143" id="L143">
                143
              </a>
            </td>
            <td class="line-content">          let type = await entry.type();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L144" id="L144">
                144
              </a>
            </td>
            <td class="line-content">          return {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L145" id="L145">
                145
              </a>
            </td>
            <td class="line-content">            oid: await entry.oid(),</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L146" id="L146">
                146
              </a>
            </td>
            <td class="line-content">            type: type,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L147" id="L147">
                147
              </a>
            </td>
            <td class="line-content">            mode: (await entry.mode()).toString("8")</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L148" id="L148">
                148
              </a>
            </td>
            <td class="line-content">          }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L149" id="L149">
                149
              </a>
            </td>
            <td class="line-content">        }))</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L150" id="L150">
                150
              </a>
            </td>
            <td class="line-content">      };</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L151" id="L151">
                151
              </a>
            </td>
            <td class="line-content">    }})</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L152" id="L152">
                152
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L153" id="L153">
                153
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L154" id="L154">
                154
              </a>
            </td>
            <td class="line-content">  getDateOfCommit(commitEntry){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L155" id="L155">
                155
              </a>
            </td>
            <td class="line-content">    let timestampedMetadata = (commitEntry.commit||commitEntry.object)?.author</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L156" id="L156">
                156
              </a>
            </td>
            <td class="line-content">      || (commitEntry.tag||commitEntry.object)?.tagger</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L157" id="L157">
                157
              </a>
            </td>
            <td class="line-content">    return new Date((timestampedMetadata.timestamp - timestampedMetadata.timezoneOffset * 60) * 1000);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L158" id="L158">
                158
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L159" id="L159">
                159
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L160" id="L160">
                160
              </a>
            </td>
            <td class="line-content">  async getHistory(ref, path, repo) {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L161" id="L161">
                161
              </a>
            </td>
            <td class="line-content">    if(!path){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L162" id="L162">
                162
              </a>
            </td>
            <td class="line-content">      path = "."</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L163" id="L163">
                163
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L164" id="L164">
                164
              </a>
            </td>
            <td class="line-content">    let {refPathMap} = await this.getStaticHelpers(repo);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L165" id="L165">
                165
              </a>
            </td>
            <td class="line-content">    const log = await this.getLog(ref);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L166" id="L166">
                166
              </a>
            </td>
            <td class="line-content">    return log</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L167" id="L167">
                167
              </a>
            </td>
            <td class="line-content">      .map(entry => ({</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L168" id="L168">
                168
              </a>
            </td>
            <td class="line-content">        ref: entry.oid,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L169" id="L169">
                169
              </a>
            </td>
            <td class="line-content">        timestamp: entry.commit.author.timestamp,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L170" id="L170">
                170
              </a>
            </td>
            <td class="line-content">        checksum: refPathMap.get(entry.oid)?.get(path)?.oid,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L171" id="L171">
                171
              </a>
            </td>
            <td class="line-content">        entry</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L172" id="L172">
                172
              </a>
            </td>
            <td class="line-content">      }))</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L173" id="L173">
                173
              </a>
            </td>
            <td class="line-content">      .filter(a => a.checksum)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L174" id="L174">
                174
              </a>
            </td>
            <td class="line-content">      .sort((a,b) => a.timestamp - b.timestamp)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L175" id="L175">
                175
              </a>
            </td>
            <td class="line-content">      .filter((a,i,l) => l.findIndex(b => b.checksum === a.checksum) === i)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L176" id="L176">
                176
              </a>
            </td>
            <td class="line-content">      .sort((a,b) => b.timestamp - a.timestamp)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L177" id="L177">
                177
              </a>
            </td>
            <td class="line-content">      .map(a => a.entry);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L178" id="L178">
                178
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L179" id="L179">
                179
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L180" id="L180">
                180
              </a>
            </td>
            <td class="line-content">  getStaticHelpersSync(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L181" id="L181">
                181
              </a>
            </td>
            <td class="line-content">    if(!this.helperMaps){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L182" id="L182">
                182
              </a>
            </td>
            <td class="line-content">      throw new Error(`getStaticHelpersSync requires preloading the staticHelpers during initialization.`)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L183" id="L183">
                183
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L184" id="L184">
                184
              </a>
            </td>
            <td class="line-content">    return this.helperMaps;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L185" id="L185">
                185
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L186" id="L186">
                186
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L187" id="L187">
                187
              </a>
            </td>
            <td class="line-content">  async getStaticHelpers(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L188" id="L188">
                188
              </a>
            </td>
            <td class="line-content">    if(this.helperMaps){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L189" id="L189">
                189
              </a>
            </td>
            <td class="line-content">      return this.helperMaps;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L190" id="L190">
                190
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L191" id="L191">
                191
              </a>
            </td>
            <td class="line-content">    const namedRefs = await this.getNamedRefs();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L192" id="L192">
                192
              </a>
            </td>
            <td class="line-content">    const commitRefs = await this.getCommitRefs();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L193" id="L193">
                193
              </a>
            </td>
            <td class="line-content">    const refs = namedRefs.concat(commitRefs);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L194" id="L194">
                194
              </a>
            </td>
            <td class="line-content">    if(this.verbose){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L195" id="L195">
                195
              </a>
            </td>
            <td class="line-content">      console.log(`Initializing repo ${this.getName()}, processing ${refs.length} refs`)</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L196" id="L196">
                196
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L197" id="L197">
                197
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L198" id="L198">
                198
              </a>
            </td>
            <td class="line-content">    const completeWalk = await this.walk(refs);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L199" id="L199">
                199
              </a>
            </td>
            <td class="line-content">    const pathMap = new Map();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L200" id="L200">
                200
              </a>
            </td>
            <td class="line-content">    const oidMap = new Map();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L201" id="L201">
                201
              </a>
            </td>
            <td class="line-content">    const blobOidSet = new Set();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L202" id="L202">
                202
              </a>
            </td>
            <td class="line-content">    const refPathMap = new Map(refs.map(ref => [ref, new Map()]));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L203" id="L203">
                203
              </a>
            </td>
            <td class="line-content">    completeWalk.forEach(({path, entries}) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L204" id="L204">
                204
              </a>
            </td>
            <td class="line-content">      pathMap.set(path, new Map(entries.flatMap((entry, index) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L205" id="L205">
                205
              </a>
            </td>
            <td class="line-content">        if(!entry){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L206" id="L206">
                206
              </a>
            </td>
            <td class="line-content">          return [];</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L207" id="L207">
                207
              </a>
            </td>
            <td class="line-content">        }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L208" id="L208">
                208
              </a>
            </td>
            <td class="line-content">        return [[refs[index], entry]]</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L209" id="L209">
                209
              </a>
            </td>
            <td class="line-content">      })));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L210" id="L210">
                210
              </a>
            </td>
            <td class="line-content">      if(this.isBadPath(path)) {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L211" id="L211">
                211
              </a>
            </td>
            <td class="line-content">        let oids = entries.map(entry => entry?.oid).filter(id=>id);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L212" id="L212">
                212
              </a>
            </td>
            <td class="line-content">        refs.forEach(ref => oids.forEach(oid => refPathMap.get(ref).set(oid, null)));</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L213" id="L213">
                213
              </a>
            </td>
            <td class="line-content">        entries.forEach((entry, index) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L214" id="L214">
                214
              </a>
            </td>
            <td class="line-content">          if(entry){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L215" id="L215">
                215
              </a>
            </td>
            <td class="line-content">            refPathMap.get(refs[index]).set(entry.oid, entry);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L216" id="L216">
                216
              </a>
            </td>
            <td class="line-content">          }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L217" id="L217">
                217
              </a>
            </td>
            <td class="line-content">        })</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L218" id="L218">
                218
              </a>
            </td>
            <td class="line-content">      }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L219" id="L219">
                219
              </a>
            </td>
            <td class="line-content">      entries.forEach((entry, index) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L220" id="L220">
                220
              </a>
            </td>
            <td class="line-content">        if(entry){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L221" id="L221">
                221
              </a>
            </td>
            <td class="line-content">          oidMap.set(entry.oid, path);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L222" id="L222">
                222
              </a>
            </td>
            <td class="line-content">          blobOidSet.add(entry.oid);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L223" id="L223">
                223
              </a>
            </td>
            <td class="line-content">        }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L224" id="L224">
                224
              </a>
            </td>
            <td class="line-content">        refPathMap.get(refs[index]).set(path, entry);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L225" id="L225">
                225
              </a>
            </td>
            <td class="line-content">      });</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L226" id="L226">
                226
              </a>
            </td>
            <td class="line-content">    });</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L227" id="L227">
                227
              </a>
            </td>
            <td class="line-content">    this.helperMaps = {namedRefs, pathMap, oidMap, refPathMap, blobOidSet};</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L228" id="L228">
                228
              </a>
            </td>
            <td class="line-content">    return this.helperMaps;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L229" id="L229">
                229
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L230" id="L230">
                230
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L231" id="L231">
                231
              </a>
            </td>
            <td class="line-content">  async getDiff(refFrom, refTo){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L232" id="L232">
                232
              </a>
            </td>
            <td class="line-content">    const decoder = new TextDecoder("utf-8");</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L233" id="L233">
                233
              </a>
            </td>
            <td class="line-content">    let diffList = [];</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L234" id="L234">
                234
              </a>
            </td>
            <td class="line-content">    if(!refFrom){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L235" id="L235">
                235
              </a>
            </td>
            <td class="line-content">      await git.walk({</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L236" id="L236">
                236
              </a>
            </td>
            <td class="line-content">        ...this.config,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L237" id="L237">
                237
              </a>
            </td>
            <td class="line-content">        trees: [git.TREE({ ref: refTo })],</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L238" id="L238">
                238
              </a>
            </td>
            <td class="line-content">        map: async (path, [nodeTo]) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L239" id="L239">
                239
              </a>
            </td>
            <td class="line-content">          if(path === "." &#x26;&#x26; (await nodeTo?.type()) !== 'blob') {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L240" id="L240">
                240
              </a>
            </td>
            <td class="line-content">            return;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L241" id="L241">
                241
              </a>
            </td>
            <td class="line-content">          }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L242" id="L242">
                242
              </a>
            </td>
            <td class="line-content">          const oidTo = await nodeTo?.oid();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L243" id="L243">
                243
              </a>
            </td>
            <td class="line-content">          diffList.push({type: "ADD", path, oidFrom: null, oidTo, diff: []});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L244" id="L244">
                244
              </a>
            </td>
            <td class="line-content">        }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L245" id="L245">
                245
              </a>
            </td>
            <td class="line-content">      });</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L246" id="L246">
                246
              </a>
            </td>
            <td class="line-content">      return diffList;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L247" id="L247">
                247
              </a>
            </td>
            <td class="line-content">    }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L248" id="L248">
                248
              </a>
            </td>
            <td class="line-content">    await git.walk({</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L249" id="L249">
                249
              </a>
            </td>
            <td class="line-content">      ...this.config,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L250" id="L250">
                250
              </a>
            </td>
            <td class="line-content">      trees: [git.TREE({ ref: refFrom }), git.TREE({ ref: refTo })],</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L251" id="L251">
                251
              </a>
            </td>
            <td class="line-content">      map: async (path, [nodeFrom, nodeTo]) => {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L252" id="L252">
                252
              </a>
            </td>
            <td class="line-content">        if (path === '.'</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L253" id="L253">
                253
              </a>
            </td>
            <td class="line-content">          || (await nodeFrom?.type()) !== 'blob' &#x26;&#x26; (await nodeTo?.type()) !== 'blob') {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L254" id="L254">
                254
              </a>
            </td>
            <td class="line-content">          return</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L255" id="L255">
                255
              </a>
            </td>
            <td class="line-content">        }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L256" id="L256">
                256
              </a>
            </td>
            <td class="line-content">        const oidFrom = await nodeFrom?.oid();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L257" id="L257">
                257
              </a>
            </td>
            <td class="line-content">        const oidTo = await nodeTo?.oid();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L258" id="L258">
                258
              </a>
            </td>
            <td class="line-content">        if(oidFrom === oidTo){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L259" id="L259">
                259
              </a>
            </td>
            <td class="line-content">          return;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L260" id="L260">
                260
              </a>
            </td>
            <td class="line-content">        } else if(!oidFrom){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L261" id="L261">
                261
              </a>
            </td>
            <td class="line-content">          diffList.push({type: "ADD", path, oidFrom, oidTo, diff: []});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L262" id="L262">
                262
              </a>
            </td>
            <td class="line-content">        } else if(!oidTo){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L263" id="L263">
                263
              </a>
            </td>
            <td class="line-content">          diffList.push({type: "REMOVE", path, oidFrom, oidTo, diff: []});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L264" id="L264">
                264
              </a>
            </td>
            <td class="line-content">        } else if(this.ignoreDiffFilter?.(path)) {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L265" id="L265">
                265
              </a>
            </td>
            <td class="line-content">          diffList.push({type: "IGNORED", path, oidFrom, oidTo, diff: []});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L266" id="L266">
                266
              </a>
            </td>
            <td class="line-content">        } else {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L267" id="L267">
                267
              </a>
            </td>
            <td class="line-content">          let contentFrom = await nodeFrom.content();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L268" id="L268">
                268
              </a>
            </td>
            <td class="line-content">          let contentTo = await nodeTo.content();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L269" id="L269">
                269
              </a>
            </td>
            <td class="line-content">          if(this.maxFileSizeForDiff !== undefined &#x26;&#x26; (contentFrom.length > this.maxFileSizeForDiff || contentTo.length > this.maxFileSizeForDiff)) {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L270" id="L270">
                270
              </a>
            </td>
            <td class="line-content">            diffList.push({type: "TOO_LONG", path, oidFrom, oidTo, diff: []});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L271" id="L271">
                271
              </a>
            </td>
            <td class="line-content">            return;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L272" id="L272">
                272
              </a>
            </td>
            <td class="line-content">          }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L273" id="L273">
                273
              </a>
            </td>
            <td class="line-content">          diffList.push({</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L274" id="L274">
                274
              </a>
            </td>
            <td class="line-content">            type: "MODIFY",</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L275" id="L275">
                275
              </a>
            </td>
            <td class="line-content">            path,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L276" id="L276">
                276
              </a>
            </td>
            <td class="line-content">            oidFrom,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L277" id="L277">
                277
              </a>
            </td>
            <td class="line-content">            oidTo,</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L278" id="L278">
                278
              </a>
            </td>
            <td class="line-content">            diff: Diff.diffLines(decoder.decode(contentFrom), decoder.decode(contentTo))</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L279" id="L279">
                279
              </a>
            </td>
            <td class="line-content">          })</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L280" id="L280">
                280
              </a>
            </td>
            <td class="line-content">        }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L281" id="L281">
                281
              </a>
            </td>
            <td class="line-content">      }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L282" id="L282">
                282
              </a>
            </td>
            <td class="line-content">    });</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L283" id="L283">
                283
              </a>
            </td>
            <td class="line-content">    return diffList;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L284" id="L284">
                284
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L285" id="L285">
                285
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L286" id="L286">
                286
              </a>
            </td>
            <td class="line-content">  async initialize(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L287" id="L287">
                287
              </a>
            </td>
            <td class="line-content">    await this.getStaticHelpers();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L288" id="L288">
                288
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L289" id="L289">
                289
              </a>
            </td>
            <td class="line-content">}</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L290" id="L290">
                290
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L291" id="L291">
                291
              </a>
            </td>
            <td class="line-content">const repoMap = new Map();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L292" id="L292">
                292
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L293" id="L293">
                293
              </a>
            </td>
            <td class="line-content">export function getRepos(){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L294" id="L294">
                294
              </a>
            </td>
            <td class="line-content">  return Array.from(repoMap.values());</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L295" id="L295">
                295
              </a>
            </td>
            <td class="line-content">}</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L296" id="L296">
                296
              </a>
            </td>
            <td class="line-content">export function getRepo(repoName){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L297" id="L297">
                297
              </a>
            </td>
            <td class="line-content">  return repoMap.get(repoName); </td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L298" id="L298">
                298
              </a>
            </td>
            <td class="line-content">}</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L299" id="L299">
                299
              </a>
            </td>
            <td class="line-content"></td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L300" id="L300">
                300
              </a>
            </td>
            <td class="line-content">export default async function initialize({repositories, ...commonConfig}) {</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L301" id="L301">
                301
              </a>
            </td>
            <td class="line-content">  if(repoMap.size > 0){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L302" id="L302">
                302
              </a>
            </td>
            <td class="line-content">    return;</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L303" id="L303">
                303
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L304" id="L304">
                304
              </a>
            </td>
            <td class="line-content">  for(let repoConfig of repositories){</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L305" id="L305">
                305
              </a>
            </td>
            <td class="line-content">    let repo = new Repo({...commonConfig, ...repoConfig});</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L306" id="L306">
                306
              </a>
            </td>
            <td class="line-content">    repoMap.set(repo.getName(), repo);</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L307" id="L307">
                307
              </a>
            </td>
            <td class="line-content">    await repo.initialize();</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L308" id="L308">
                308
              </a>
            </td>
            <td class="line-content">  }</td>
          </tr><tr class="line">
            <td class="line-number">
              <a href="#L309" id="L309">
                309
              </a>
            </td>
            <td class="line-content">}</td>
          </tr>
        
      </tbody>
    </table>
  </div>
</section>
  </article>




  
</body></html>